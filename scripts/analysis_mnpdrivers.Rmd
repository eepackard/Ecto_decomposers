---
title: "analysis_ectodecomposers"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#load packages
```{r include =FALSE}
library(readr)
library(car)
library(Rlab)
library(vegan)
library(ggplot2)
library(dplyr)
library(tidyr)
library(factoextra)
library(corrgram)
library(lme4)
library(splitstackshape)
library(ggfortify)
library(ggrepel)
```

#read in data
```{r}
datasetlist.rel.15<-list(read_csv("../clean_data/SS_data_relabun_15_2perc.csv"),read_csv("../clean_data/SS_data_relabun_15_3perc.csv"),read_csv("../clean_data/SS_data_relabun_15_4perc.csv"))
Meta.data.spatial<-read_csv("../clean_data/Clean_spatial_study_metadata.csv")
```


#model the abio factors then abio plus with the subset taxa

#create detrended MnP 
```{r}

MnP.v.NC<-lm(Meta.data.spatial$MnP_gOM.log~Meta.data.spatial$NC+Meta.data.spatial$ph)
MnP.res<-residuals(MnP.v.NC)

Meta.data.spatial$MnP.res<-MnP.res
```

#run CCA
```{r}
#restrict permutations within sites 
ctrl<-how(nperm = 1000, blocks = Meta.data.spatial$plot)

set.seed(13)
MnP.CCA.1<-cca(sqrt(datasetlist.rel.15[[1]])~Meta.data.spatial$MnP_gOM.log)
MnP.CCA.2<-cca(sqrt(datasetlist.rel.15[[1]])~Meta.data.spatial$MnP.res)

plot(MnP.CCA)

anova(MnP.CCA.1,permutations = ctrl)
anova(MnP.CCA.2,permutations = ctrl)
```


